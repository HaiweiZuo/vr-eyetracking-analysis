<!-- 综合特征提取模块内容 -->
<div class="container-fluid" style="min-height: 800px; padding: 20px;">
    <!-- 页面标题 -->
    <div class="row mb-4">
        <div class="col-12">
            <h2 style="color: #007bff;"><i class="fas fa-brain"></i> 综合特征提取与整合</h2>
            <p class="lead" style="color: #6c757d;">✅ 现在在content-wrapper内部的正确位置！</p>
        </div>
    </div>

    <div class="row">
        <!-- 左侧控制面板 -->
        <div class="col-lg-4" style="min-height: 600px;">
            <div class="card h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-sliders-h"></i> 特征提取控制</h5>
                </div>
                <div class="card-body">
                    
                    <!-- 数据源状态 -->
                    <div class="mb-4">
                        <h6><i class="fas fa-database"></i> 数据源状态</h6>
                        <div class="list-group">
                            <div class="list-group-item d-flex justify-content-between align-items-center" id="eventsDataStatus">
                                <span>眼动事件数据</span>
                                <i class="fas fa-circle-notch fa-spin text-warning"></i>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center" id="roiDataStatus">
                                <span>ROI汇总数据</span>
                                <i class="fas fa-circle-notch fa-spin text-warning"></i>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center" id="rqaDataStatus">
                                <span>RQA分析数据</span>
                                <i class="fas fa-circle-notch fa-spin text-warning"></i>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center" id="mmseDataStatus">
                                <span>MMSE评分数据</span>
                                <i class="fas fa-circle-notch fa-spin text-warning"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 特征提取配置 -->
                    <div class="mb-4">
                        <h6><i class="fas fa-cog"></i> 提取配置</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="taskFeatures" checked>
                            <label class="form-check-label" for="taskFeatures">任务级别特征</label>
                            <small class="form-text text-muted">完成时间、注视转移熵、扫视路径等</small>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="roiFeatures" checked>
                            <label class="form-check-label" for="roiFeatures">ROI级别特征</label>
                            <small class="form-text text-muted">注视密度、访问序列、重要性评分等</small>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="rqaFeatures" checked>
                            <label class="form-check-label" for="rqaFeatures">RQA增强特征</label>
                            <small class="form-text text-muted">跨任务变异性、时间演变趋势等</small>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="mmseIntegration" checked>
                            <label class="form-check-label" for="mmseIntegration">MMSE数据整合</label>
                            <small class="form-text text-muted">认知评分数据合并</small>
                        </div>
                    </div>
                    
                    <!-- 执行按钮 -->
                    <div class="mb-4">
                        <button class="btn btn-primary btn-lg w-100" onclick="startFeatureExtraction()" id="extractButton">
                            <i class="fas fa-play"></i> 开始特征提取
                        </button>
                        <div class="progress mt-3" id="extractionProgress" style="display: none;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="extractionProgressBar">
                                <span id="extractionProgressText">准备中...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 历史记录 -->
                    <div>
                        <h6><i class="fas fa-history"></i> 提取历史</h6>
                        <button class="btn btn-outline-secondary btn-sm w-100 mb-2" onclick="loadExtractionHistory()">
                            <i class="fas fa-refresh"></i> 刷新历史记录
                        </button>
                        <div id="extractionHistoryList">
                            <p class="text-muted small">暂无历史记录</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 右侧结果展示 -->
        <div class="col-lg-8" style="min-height: 600px;">
            <div class="card h-100">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-bar"></i> 特征提取结果</h5>
                </div>
                <div class="card-body">
                    <!-- 状态显示区域 -->
                    <div class="card mb-4" id="extractionStatusCard" style="display: none;">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="status-icon me-3">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1" id="statusTitle">准备就绪</h6>
                                    <p class="mb-0" id="statusMessage">请点击开始特征提取按钮</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 结果摘要区域 -->
                    <div id="resultsSummary" style="display: none;">
                        <h6><i class="fas fa-chart-line"></i> 提取摘要</h6>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center p-3">
                                        <h5 class="mb-0" id="summarySubjects">-</h5>
                                        <small class="text-muted">被试总数</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center p-3">
                                        <h5 class="mb-0" id="summaryFeatures">-</h5>
                                        <small class="text-muted">特征总数</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 快速统计 -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <i class="fas fa-users fa-2x text-primary mb-2"></i>
                                    <h6 class="mb-0" id="totalSubjects">-</h6>
                                    <small class="text-muted">被试数量</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <i class="fas fa-tasks fa-2x text-info mb-2"></i>
                                    <h6 class="mb-0" id="totalTasks">-</h6>
                                    <small class="text-muted">任务数量</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <i class="fas fa-list fa-2x text-warning mb-2"></i>
                                    <h6 class="mb-0" id="featureCount">-</h6>
                                    <small class="text-muted">特征数量</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center p-3">
                                    <i class="fas fa-clock fa-2x text-success mb-2"></i>
                                    <h6 class="mb-0" id="extractionTime">-</h6>
                                    <small class="text-muted">提取时间</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 结果文件 -->
                    <div id="resultsFiles" style="display: none;">
                        <h6><i class="fas fa-file-alt"></i> 生成的文件</h6>
                        <div class="list-group">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-file-csv text-success me-2"></i>
                                    <strong>Master_Features.csv</strong>
                                    <br><small class="text-muted">主特征表 - 任务级别详细特征</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="previewResults('master')" id="previewMasterBtn">
                                        <i class="fas fa-eye"></i> 预览
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="downloadResults('master')" id="downloadMasterBtn">
                                        <i class="fas fa-download"></i> 下载
                                    </button>
                                </div>
                            </div>
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-file-csv text-success me-2"></i>
                                    <strong>Subject_Features_Summary.csv</strong>
                                    <br><small class="text-muted">被试汇总表 - 被试级别汇总特征</small>
                                </div>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="previewResults('summary')" id="previewSummaryBtn">
                                        <i class="fas fa-eye"></i> 预览
                                    </button>
                                    <button class="btn btn-sm btn-primary" onclick="downloadResults('summary')" id="downloadSummaryBtn">
                                        <i class="fas fa-download"></i> 下载
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 数据预览表格 -->
                    <div id="dataPreview" style="display: none;">
                        <h6 class="mt-4"><i class="fas fa-table"></i> 数据预览</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered" id="previewTable">
                                <thead id="previewTableHead"></thead>
                                <tbody id="previewTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>