# Changelog

## [2.3.0] - 2025-01-27

### 🚀 Added
- **眼动事件分析模块 (Event Analysis Module)**
  - 基于IVT算法的眼动事件自动分割与分析
  - 支持注视(fixation)和扫视(saccade)事件识别
  - 新增事件特征计算：持续时间、幅度、最大/平均速度
  - ROI自动映射和统计指标计算
  - 生成`All_Events.csv`和`All_ROI_Summary.csv`分析报告
  - 新增事件分析Web界面，支持数据筛选、分页显示和导出

- **RQA递归量化分析模块 (RQA Analysis Module)**
  - 实现非线性时间序列分析算法
  - 支持1D X坐标、1D幅度、2D XY三种分析模式
  - 提供1D绝对差值和欧几里得距离度量
  - 计算9个RQA指标：RR、DET、ENT等
  - 生成递归图和时间序列图(带ROI着色)
  - 支持多数据选择和对比分析

- **新增API端点**
  - `GET /api/event-analysis/data` - 事件分析数据获取
  - `GET /api/event-analysis/summary` - 事件分析概览统计
  - `POST /api/event-analysis/regenerate` - 重新生成分析数据
  - `POST /api/rqa-analysis` - RQA分析执行
  - `POST /api/rqa-comparison` - RQA多数据对比
  - `GET /api/rqa-parameters` - RQA默认参数获取

- **完整API文档化**
  - 新增`API_DOCUMENTATION.md` - 18个REST API端点的完整文档
  - 包含请求/响应示例、参数说明、错误处理
  - 提供Python、JavaScript、cURL三种语言的使用示例
  - API版本管理和变更日志跟踪

### 🔧 Improved
- **数据预处理兼容性升级**
  - 修改`custom_vr_parser.py`确保生成完整的列结构
  - 更新`vr_eyetracking_processor.py`智能检测时间戳格式
  - 新增`fix_existing_data_files()`修复历史数据兼容性
  - 新旧数据完全兼容，支持所有校准功能

- **MMSE评分系统优化**
  - 更新为VR-MMSE分类标准(Normal:19.1±1.6, MCI:18.0±1.9, AD:13.5±2.7)
  - 满分从25分调整为21分
  - 显示Q1-Q5各任务详细分数
  - 优化UI显示：数据列表黑色字体，统计面板白色字体
  - 移除"查看详细分数"折叠区域，直接显示当前任务分数

- **前端性能优化**
  - 事件分析数据和摘要信息并行加载
  - 优化大数据集分页加载性能
  - 添加完善的加载状态指示器

- **国际化支持扩展**
  - 新增事件分析相关术语翻译
  - 新增RQA分析相关术语翻译  
  - 新增数据管理相关术语翻译
  - 中英文界面完全对应，无遗漏翻译

### 🐛 Fixed
- **🔥 HTML结构重大修复**
  - 修复RQA和事件分析视图显示在页面底部的问题
  - 删除第3323-3324行两个多余的`</div>`结束标签
  - 确保所有四个主视图正确嵌套在content-wrapper内部
  - 解决长期存在的布局结构问题

- **JSON序列化错误修复**
  - 修复numpy.float64/int64类型无法JSON序列化的问题
  - 所有数值输出强制转换为Python原生类型
  - 添加NaN值清理机制，防止前端解析错误

- **RQA路径解析错误修复**
  - 修复RQA模块无法正确找到AD组数据文件的问题
  - 重构`_find_data_file`方法，优先搜索rqa_ready目录
  - 确保所有组别数据正确加载

- **DOM元素引用错误修复**
  - 修复事件分析界面JavaScript DOM元素ID不匹配问题
  - 统一修正所有元素ID引用
  - 确保事件分析界面正常工作

### 📊 Performance
- **数据重处理优化**
  - 创建专门的`rqa_ready`目录存储带ROI信息的数据
  - 避免实时计算ROI，提升RQA分析性能
  - 批量处理所有历史数据，一次性解决兼容性问题

### 🏗️ Architecture
- **模块化架构扩展**
  - 独立的事件分析核心引擎(`analysis/event_analyzer.py`)
  - 独立的RQA分析核心引擎(`analysis/rqa_analyzer.py`)
  - API扩展模块化设计(`visualization/*_api_extension.py`)
  - 核心分析逻辑与Web界面完全分离

### 📈 Scale
- **系统规模扩展**
  - 数据处理能力：支持control/mci/ad三组各100个数据文件
  - 分析模块：4个主要功能模块(可视化、数据导入、RQA分析、事件分析)
  - API端点：20+个REST API接口
  - 代码规模：新增~3000行Python代码，~2000行JavaScript代码

---

# VR眼动数据处理工具 - 变更日志

本文档记录VR眼动数据处理工具的所有重要变更。

## [v2.2.0] - 2025-01-28 ⭐ **当前版本**

### 🧠 新增功能 - MMSE认知评估系统
- **VR-MMSE评分集成**: 采用21分满分的VR-MMSE评分标准
- **认知等级分类**: 正常、正常范围、轻度认知障碍、阿尔兹海默症、重度认知障碍
- **详细任务分析**: Q1-Q5各项认知任务的分项分数展示
- **多语言支持**: 中英文评估等级和任务名称完整本地化
- **智能数据映射**: 自动解析受试者ID并匹配MMSE评分数据

### 🔧 系统优化
- **实时校准增强**: 支持X/Y坐标偏移和时间范围的双重校准
- **数据管理功能**: 支持数据组别迁移、删除等完整管理操作
- **兼容性修复工具**: 自动为旧数据文件添加时间校准所需列
- **界面显示优化**: 深色背景下的白色文字显示，提升可读性

### 🐛 问题修复
- 修复jQuery加载顺序导致的脚本错误
- 解决MMSE数据列名兼容性问题(支持'受试者'和'试者')
- 清理重复函数定义，统一异步数据加载逻辑
- 修复时间校准保存时的JavaScript错误

### 📊 技术改进
- **REST API扩展**: 新增MMSE评分获取和统计API接口
- **数据缓存机制**: MMSE数据加载缓存，响应时间<150ms
- **模块化架构**: MMSE功能模块化设计，便于扩展
- **错误处理增强**: 完善的错误诊断和回退机制

---

## [v2.1.0] - 2025-07-26

### 🌐 新增功能 - Web数据导入系统
- **智能侧边栏**: 可收缩的导航栏，支持模块切换
- **批量文件上传**: 支持1.txt-5.txt的完整被试数据上传
- **自动数据处理**: 文件验证→预处理→校准的全自动流程
- **实时反馈系统**: 详细的处理日志和进度显示
- **无缝系统集成**: 新导入数据自动集成到可视化列表

### 🔧 数据处理增强
- **自定义VR格式解析器**: 支持特殊VR数据格式处理
- **智能文件命名**: 自动生成标准格式文件名
- **多格式兼容**: 同时支持标准格式和自定义VR格式
- **临时文件管理**: 安全的临时存储和自动清理机制

### 📋 系统架构改进
- **模块化设计**: 分离的前端和后端功能模块
- **多语言界面**: 完整的中英文界面本地化
- **响应式布局**: 适配不同屏幕尺寸的现代化UI
- **错误诊断系统**: 详细的日志记录和错误报告

---

## [v2.0.0] - 2025-06-15

### 🎯 核心功能重构
- **Web可视化界面**: 全新的Web界面，支持眼动轨迹可视化
- **三组数据支持**: Control、MCI、AD三组数据的完整处理流程
- **实时校准系统**: 个体化和组级别的精确校准参数
- **ROI区域分析**: 关键词、指令、背景区域的智能标记

### 📊 数据处理优化
- **批量处理能力**: 支持大规模数据集的高效处理
- **统一命名规范**: 解决历史数据命名不一致问题
- **多阶段输出**: raw→processed→calibrated的完整数据流
- **质量控制机制**: 速度阈值和Z-score统计过滤

---

## [v1.0.0] - 2025-01-15

### 🚀 初始版本发布
- **基础数据处理**: VR眼动数据的解析和预处理
- **坐标校准功能**: 基础的坐标偏移校准
- **命令行工具**: 完整的命令行处理接口
- **配置系统**: 灵活的参数配置和管理

---

## 📋 版本号说明

本项目采用语义化版本号 (Semantic Versioning):
- **主版本号**: 不兼容的API修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

## 🔗 相关文档

- [详细开发日志](DEVELOPMENT_LOG.md)
- [项目结构说明](PROJECT_STRUCTURE.md)
- [校准系统演示](CALIBRATION_SYSTEM_DEMO.md)
- [用户使用指南](README.md)

---

**项目维护**: VR眼动数据处理工具开发团队  
**最后更新**: 2025年1月28日 