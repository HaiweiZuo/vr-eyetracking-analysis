# 🧪 模块7真实数据整合测试指南

> **测试目标**: 验证从模拟数据到真实数据的完整转换  
> **测试时间**: 立即开始  
> **预期结果**: 成功加载306条真实整合数据

---

## 🚀 **立即测试步骤**

### **Step 1: 启动服务器**
```bash
# 在项目根目录执行
python start_server.py

# 或使用批处理文件
启动服务器.bat
```

**预期输出**:
```
✅ MMSE对比分析功能已启用
✅ 真实数据整合功能已启用  # ← 新增功能
* Running on http://127.0.0.1:8080
```

### **Step 2: 访问模块7**
1. 打开浏览器访问 `http://127.0.0.1:8080`
2. 点击左侧菜单的 **"📊 数据整理"**
3. 查看界面是否正确显示

**预期界面变化**:
- ✅ 新增RQA参数配置选择器
- ✅ 按钮文字从"刷新数据"改为"加载真实数据"  
- ✅ 选择器默认显示 "m=2, τ=1, ε=0.055, l_min=2"

### **Step 3: 执行数据整合**
1. 保持默认RQA配置选择
2. 点击 **"加载真实数据"** 按钮
3. 观察控制台输出和界面状态

**预期过程** (第一次运行):
```javascript
🚀 === 开始加载真实整合数据流程 ===
📊 选择的RQA配置: m2_tau1_eps0.055_lmin2
🔄 第1步: 检查缓存数据...
⚠️ 缓存不存在，开始真实数据整合...
📡 第2步: 收到响应 (XXXXms)
📄 第3步: 解析JSON响应...
📄 第4步: JSON解析完成 (XXms)
📊 解析后的数据行数: 306  # ← 关键指标
🎨 第5步: 更新数据表格...
🎨 第6步: 表格更新完成 (XXms)
✅ === 真实数据整合流程完成，总用时: XXXXms ===
```

**预期界面更新**:
- ✅ 状态栏显示: "✅ 真实数据整合完成: 306 条记录 (m2_tau1_eps0.055_lmin2)"
- ✅ 数据表格填充真实数据
- ✅ 图表使用真实数据渲染

### **Step 4: 验证数据质量**

#### **4.1 检查数据量**
- **期望**: 大约306条记录 (接近现有归一化数据)
- **验证**: 查看控制台的"解析后的数据行数"

#### **4.2 检查属性完整性**
- **期望**: 每条记录包含10个归一化属性
- **验证**: 打开浏览器开发者工具，查看数据样本

#### **4.3 检查ID格式**
- **期望**: session_id格式如 `n1q1`, `m5q`, `ad10q3`
- **验证**: 在表格中查看受试者ID列

#### **4.4 检查数值范围**
- **期望**: 所有归一化属性值在[0,1]范围内
- **验证**: 查看表格数值是否合理

### **Step 5: 测试缓存机制**
1. 再次点击 **"加载真实数据"** 按钮
2. 观察是否快速加载 (使用缓存)

**预期过程** (第二次运行):
```javascript
🚀 === 开始加载真实整合数据流程 ===
📊 选择的RQA配置: m2_tau1_eps0.055_lmin2
🔄 第1步: 检查缓存数据...
✅ 使用缓存的整合数据: 306 条记录  # ← 直接使用缓存
📄 第3步: 解析JSON响应...
✅ === 真实数据整合流程完成，总用时: <100ms ===  # ← 明显更快
```

---

## 🔍 **深度验证测试**

### **数据源验证**
打开 `data/module7_integrated_results/m2_tau1_eps0.055_lmin2/` 目录:
- ✅ `integrated_features_summary.csv` 文件存在
- ✅ `metadata.json` 包含完整元数据
- ✅ 文件大小合理 (约50-100KB)

### **后端日志验证**
服务器控制台应显示:
```
📊 加载校准数据...
✅ 加载了 XXX 个会话的游戏时长
📊 加载ROI特征数据...  
✅ 加载了 XXX 个会话的ROI特征
📊 加载RQA特征数据 (m2_tau1_eps0.055_lmin2)...
✅ 加载了 XXX 个会话的RQA特征
📊 归一化特征数据...
✅ 特征整合完成: 306 条记录
✅ 结果已保存到: data/module7_integrated_results/m2_tau1_eps0.055_lmin2
```

---

## ❌ **可能的错误与解决**

### **错误1: API路由未注册**
**现象**: `404 Not Found`
**解决**: 检查 `enhanced_web_visualizer.py` 是否正确导入真实数据API

### **错误2: 数据文件缺失**
**现象**: `❌ XXX文件不存在`
**解决**: 确认以下文件存在:
- `data/*/calibrated/*/*.csv`
- `data/event_analysis_results/All_ROI_Summary.csv`
- `data/rqa_pipeline_results/m2_tau1_eps0.055_lmin2/step1_rqa_calculation/RQA_1D2D_summary_*.csv`

### **错误3: 权限问题**
**现象**: `PermissionError`
**解决**: 确保对 `data/module7_integrated_results/` 目录有写权限

### **错误4: 内存不足**
**现象**: 处理缓慢或崩溃
**解决**: 检查可用内存，考虑分批处理大文件

---

## 🎯 **成功标准**

### **功能性指标**
- ✅ 界面正确显示RQA配置选择器
- ✅ 数据整合流程正常完成
- ✅ 生成合理数量的记录 (250-350条)
- ✅ 缓存机制正常工作

### **性能指标**
- ✅ 首次整合耗时 < 30秒
- ✅ 缓存加载耗时 < 2秒
- ✅ 界面响应流畅

### **数据质量指标**
- ✅ 10个属性完整无缺失
- ✅ 归一化值在合理范围[0,1]
- ✅ ID格式正确匹配
- ✅ 组别分布平衡

---

## 🔄 **下一步计划**

### **如果测试成功**:
1. **优化性能**: 添加进度条和异步处理
2. **扩展配置**: 添加更多RQA参数选项
3. **完善模块8**: 使用新的真实数据API
4. **文档更新**: 更新API文档和用户指南

### **如果测试失败**:
1. **错误诊断**: 详细分析错误日志
2. **数据验证**: 检查原始数据文件完整性
3. **代码调试**: 逐步验证数据提取逻辑
4. **回滚方案**: 保留现有归一化数据作为备份

---

**🎯 立即行动**

现在请启动服务器并按照上述步骤进行测试。重点关注控制台输出和数据量验证，如有任何异常请立即报告！